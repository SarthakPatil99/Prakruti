{%extends 'Admin/admin_base.html'%} {% load static %}

<!-- 
{% block title%}
Patients
{%endblock title%}

{% block admin_title2%} 
/Patients 
{%endblock admin_title2%}
-->
{%block activeP%}
<!-- Divider -->
<hr
    style="width: 15px; border: 3px solid rgb(255, 183, 0); border-radius: 5px; opacity: 80%; margin-top: 0%; margin-bottom: 1%;">
{% endblock activeP%}

{% block body %}

<div class="d-flex justify-content-between">
    <button type="button" class="btn btn-warning mx-3 mb-3" data-toggle="modal" data-target="#add_PModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="21" fill="currentColor" class="bi bi-plus-circle"
            viewBox="0.5 2 15 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
            <path
                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
        </svg>
        New
    </button>

    <!-- Creation modal -->
    <div class="modal" id="add_PModal">
        <div class="modal-dialog">
            <div class="modal-content" style="border: none; background-color: rgb(221, 221, 221); z-index: 3">
                <div class="modal-header bg-secondary">
                    <h4 class="modal-title text-warning">New Patient</h4>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>

                {% for message in messages %} {% if message.tags == "error" %}
                <div class="alert alert-danger alert-dismissible fade show msg" role="alert">
                    <strong>{{ message.tags }}!</strong> {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endif %} {% endfor %}

                <div class="modal-body">
                    <form action="/patients/" method="post" enctype="multipart/form-data">
                        <label for="name" class="form-label"> <b>Full Name:</b> </label>
                        <div class="row mb-2">
                            <div class="col-12 col-md-12 col-lg-4">
                                <input type="first name" class="form-control" id="fname" placeholder="First Name" name="fname" required />
                            </div>
                            <div class="col-12 col-md-12 col-lg-4 py-2 py-lg-0">
                                <input type="middle name" class="form-control" id="mname" placeholder="Middle Name" name="mname" required />
                            </div>
                            <div class="col-12 col-md-12 col-lg-4">
                                <input type="last name" class="form-control" id="lame" placeholder="Last Name" name="lname" required />
                            </div>
                        </div>

                        <div class="row mb-2">
                            <div class="col-12 col-md-6 col-lg-6">
                                <label for="email" class="form-label"> <b>Email:</b> </label>
                                <input type="email" class="form-control" id="emailP" placeholder="Email" name="email"
                                    onfocusout="validateEmail()" required />
                            </div>
                            <div class="col-12 col-md-6 col-lg-6">
                                <label for="phone" class="form-label">
                                    <b>Phone Number:</b>
                                </label>
                                <input type="number" class="form-control" id="phone" placeholder="Phone No."
                                    name="phone" onfocusout="validatePhone()" required />
                            </div>
                        </div>

                        <div class="row mb-2">
                            <div class="col-6 col-md-6 col-lg-4">
                                <label for="age" class="form-label"> <b>Age:</b> </label>
                                <input type="number" class="form-control" id="age" placeholder="Age" name="age"
                                    onfocusout="validateAge()" required />
                            </div>
                            <div class="col-6 col-md-6 col-lg-4">
                                <label for="Gender" class="form-label"> <b>Gender:</b> </label>
                                <select class="form-select form-select-sm form-control"
                                    aria-label=".form-select-sm example" placeholder="Select Gender" id="Gender"
                                    name="gender" onfocusout="validateGender()">
                                    <option selected value="0">Select</option>
                                    <option value="1">Male</option>
                                    <option value="2">Female</option>
                                    <option value="3">Other</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-12 col-lg-4">
                                <label for="Prakruti" class="form-label">
                                    <b>Prakruti:</b>
                                </label>
                                <select class="form-select form-select-sm form-control"
                                    aria-label=".form-select-sm example" placeholder="Select Prakruti" id="Prakruti"
                                    name="prakruti" onfocusout="validatePrakruti()">
                                    <option selected value="0">Select</option>
                                    <option value="1">Vata Kapha</option>
                                    <option value="2">Vata Pitta</option>
                                    <option value="3">Kapha Vata</option>
                                    <option value="4">Kapha Pitta</option>
                                    <option value="5">Pitta Vata</option>
                                    <option value="6">Pitta Kapha</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" name="submit" value="Create" id="Submit" class="btn btn-warning text-gray-800 mt-2 float-right">
                            Create
                        </button>
                        {% csrf_token %}
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Topbar Search -->
    <form action="/patients/" method="post" style="width: 55%;">
        <div class="input-group">
            <div class="input-group-append">
                <select class="form-select form-control bg-light" style="width:120px; border-end-end-radius: 0px; border-start-end-radius: 0px;" id="Srch" name="srch" onchange="validateSrch()">
                    <option selected value="0">Search Via</option>
                    <option value="1">Name</option>
                    <option value="2">Appnt ID</option>
                    <option value="3">Email</option>
                    <option value="4">Phone</option>
                </select>
            </div>{% csrf_token %}
            <input type="text" name="search" class="form-control bg-light" placeholder="Search for..." />
            <div class="input-group-append">
                <button class="btn btn-primary" type="submit" id="srchBtn" disabled>
                    <i class="fas fa-search fa-sm"></i>
                </button>
            </div>
        </div>
    </form>

    <div class="dropdown float-right mx-3 mb-3">
        <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton1" data-toggle="dropdown"
            aria-expanded="false">
            Sort via
        </button>
        <form action="/patients/" method="post"> 
            <ul class="dropdown-menu" style="text-align: center;">
                <li><button class="btn" name="sort" type="submit" value="first_name"> Name </button></li>
                <li><button class="btn" name="sort" type="submit" value="Age"> Age </button></li>
                <li><button class="btn" name="sort" type="submit" value="Gender"> Gender </button></li>
                <li><button class="btn" name="sort" type="submit" value="email"> EmailID </button></li>
                <li><button class="btn" name="sort" type="submit" value="Phone_No"> Phone No. </button></li>
                <li><button class="btn" name="sort" type="submit" value="P_Prakruti"> Prakruti </button></li>
            </ul>
            {% csrf_token %}
        </form>
    </div>
</div>

<table class="table table-hover table-bordered">
    <thead class="table-primary">
        <tr class="table_tr">
            <th>ID</th>
            <th>Picture</th>
            <th>Name</th>
            <th>Email ID</th>
            <th>Phone Number</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Prakruti</th>
            <th>Actions</th>
        </tr>
    </thead>
    {% for patient in patients %}
    <tbody>
        <td width="1%">{{ patient.id }}</td>
        <td width="1%">
            <center>
                <img src="../../media/{{ patient.Img }}" style="width: auto; max-height: 100px; border-radius: 5px;"
                    alt="Italian Trulli">
            </center>
        </td>
        <td class="d-flex align-items-center justify-content-between border-0">
            <label id="chang">{{ patient.first_name }} {{ patient.Middle_name }} {{ patient.last_name }}</label>
            <div class="dropdown no-arrow d-lg-inline">
                <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-warning"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                    style="width: 200px; font-size: medium;">
                        <form action="/A_profile/" method="post">
                            <button type="submit" name='patient_id' class="dropdown-item text-primary" value="{{ patient.id }}">View Patient's History</button> {% csrf_token %}
                        </form>
                </div>
            </div>
        </td>
        <td width="12%">{{ patient.email }}</td>
        <td width="12%">{{ patient.Phone_No }}</td>
        <td width="1%">{{ patient.Age }}</td>
        <td width="1%">{{ patient.Gender }}</td>
        <td width="10%">{{ patient.P_Prakruti }}-{{ patient.S_Prakruti }}</td>
        <td class="align-items-center" width="10%">
            <center>
                <form action="/patients/" method="post">
                    <Button type="submit" class="btn bg-success text-white" name="book" value="{{ patient.id }}" title="Book appointment">
                        <i class="fas fa-calendar-check"></i>
                    </Button>
                    <Button type="submit" class="btn bg-danger text-white my-1" name="remove" title="Remove appointment" value="{{ patient.username }}">
                        <i class="far fa-trash-alt"></i>
                    </Button>
                    {% csrf_token %}
                </form>
            </center>
        </td>
    </tbody>
    {% endfor %}
    <tfoot>

    </tfoot>
</table>
{% endblock body%}